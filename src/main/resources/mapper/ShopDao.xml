<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 命名空间
     通常情况下，命名空间的值就是当前操作实体类的全名称
-->
<mapper namespace="com.imooc.o2o.dao.ShopDao">
  <insert id="insert" parameterType="Shop">
    insert into o2o.shop(priority, shop_img, name, description, contact_info, addr, area_id, shop_kind_id, person_info_id, status, create_time, last_edit_time, advice)
    value (#{priority}, #{shopImg}, #{name}, #{description}, #{contactInfo}, #{addr}, #{area.areaId}, #{shopKind.shopKindId}, #{personInfo.personId}, #{status}, #{createTime}, #{lastEditTime}, #{advice});
  </insert>

  <resultMap id="shopResultMap" type="Shop">
    <id column="shop_id" property="shopId"/>
    <result column="priority" property="priority"/>
    <result column="shop_img" property="shopImg"/>
    <result column="name" property="name"/>
    <result column="description" property="description"/>
    <result column="contact_info" property="contactInfo"/>
    <result column="addr" property="addr"/>
    <association property="area">
      <id column="area_id" property="areaId"/>
      <result column="area_name" property="areaName"/>
    </association>
    <association property="shopKind">
      <id column="shop_kind_id" property="shopKindId"/>
      <result column="name" property="name"/>
    </association>
    <association property="personInfo">
      <id column="person_id" property="personId"/>
      <result column="person_name" property="personName"/>
    </association>
  </resultMap>

  <select id="queryShopById" resultMap="shopResultMap">
    SELECT
    s.shop_id,
    s.priority,
    s.shop_img,
    s.name,
    s.description,
    s.contact_info,
    s.addr,
    a.area_id,
    a.area_name,
    sk.shop_kind_id,
    sk.name as shop_kind_name,
    p.person_id,
    p.person_name
    FROM o2o.shop s
    LEFT OUTER JOIN o2o.area a ON a.area_id = s.area_id
    LEFT OUTER JOIN o2o.shop_kind sk ON sk.shop_kind_id = s.shop_kind_id
    LEFT OUTER JOIN o2o.person_info p ON p.person_id = s.person_info_id
    WHERE s.shop_id = #{id};
  </select>
</mapper>